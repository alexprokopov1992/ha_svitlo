# Power Watchdog (Home Assistant ‚Üí Telegram)

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Home Assistant, —è–∫–∞ –≤—ñ–¥—Å—Ç–µ–∂—É—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Å–≤—ñ—Ç–ª–∞ –∑–∞ **–¥–∞—Ç—á–∏–∫–æ–º –Ω–∞–ø—Ä—É–≥–∏** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ Tuya-—Ä–æ–∑–µ—Ç–∫–∏) —Ç–∞ –Ω–∞–¥—Å–∏–ª–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ **Telegram** –ø—Ä–∏ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—ñ/–ø–æ—è–≤—ñ —Å–≤—ñ—Ç–ª–∞.

## ‚úÖ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–∞–Ω—É —Å–≤—ñ—Ç–ª–∞ –∑–∞ `sensor.*voltage` (–Ω–∞–ø—Ä—É–≥–∞).
- –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ Telegram –ø—Ä–∏:
  - ‚ùå –∑–Ω–∏–∫–Ω–µ–Ω–Ω—ñ —Å–≤—ñ—Ç–ª–∞
  - ‚úÖ –ø–æ—è–≤—ñ —Å–≤—ñ—Ç–ª–∞
- –í–∏–≤–æ–¥–∏—Ç—å —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å:
  - **‚Äú–°–≤—ñ—Ç–ª–æ –±—É–ª–æ: ‚Ä¶‚Äù** –ø–µ—Ä–µ–¥ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º
  - **‚Äú–°–≤—ñ—Ç–ª–∞ –Ω–µ –±—É–ª–æ: ‚Ä¶‚Äù** –¥–æ –≤–∫–ª—é—á–µ–Ω–Ω—è
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ ‚Äú—Ñ–ª–∞–ø—ñ–≤‚Äù —á–µ—Ä–µ–∑ **debounce** (–∑–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º –ø–æ–¥—ñ—ó).
- –†–µ–∂–∏–º **stale timeout**: —è–∫—â–æ –¥–∞—Ç—á–∏–∫ –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–≤—Å—è N —Å–µ–∫—É–Ω–¥ ‚Äî –≤–≤–∞–∂–∞—î–º–æ ‚Äú—Å–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞—î‚Äù.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π ‚Äúprobe‚Äù –∫–æ–ª–∏ –æ—Ñ—Ñ–ª–∞–π–Ω: –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î `homeassistant.update_entity` –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö.
- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ): **‚Äú–ë–æ—Ç –±—É–ª–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ‚Äù**. :contentReference[oaicite:2]{index=2}

> –ß–æ–º—É –¥–∞—Ç—á–∏–∫ –Ω–∞–ø—Ä—É–≥–∏ –∫—Ä–∞—â–µ –∑–∞ `switch`?  
> –£ Tuya `switch` —á–∞—Å—Ç–æ ‚Äú–∑–∞–ª–∏–ø–∞—î‚Äù –≤ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É —Å—Ç–∞–Ω—ñ –π –Ω–µ –æ–Ω–æ–≤–ª—é—î `last_updated`, —á–µ—Ä–µ–∑ —â–æ –æ—Ñ—Ñ–ª–∞–π–Ω/–æ–Ω–ª–∞–π–Ω –º–æ–∂–µ –≤–∏–∑–Ω–∞—á–∞—Ç–∏—Å—è –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–æ. –î–∞—Ç—á–∏–∫ –Ω–∞–ø—Ä—É–≥–∏ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω—ñ—à–µ.

---

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### –í–∞—Ä—ñ–∞–Ω—Ç A: –≤—Ä—É—á–Ω—É
1. –°–∫–æ–ø—ñ—é–π –ø–∞–ø–∫—É —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –≤ Home Assistant: /config/custom_components/power_watchdog/
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ Home Assistant.

### –í–∞—Ä—ñ–∞–Ω—Ç B: —á–µ—Ä–µ–∑ HACS (—è–∫—â–æ –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ `hacs.json`)
1. HACS ‚Üí **Custom repositories**
2. –î–æ–¥–∞–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π —è–∫ **Integration**
3. –í—Å—Ç–∞–Ω–æ–≤–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ HA
4. –î–æ–¥–∞–π —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é

---

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (—á–µ—Ä–µ–∑ UI)

Home Assistant ‚Üí **Settings ‚Üí Devices & Services ‚Üí Add Integration** ‚Üí `Power Watchdog`

–ü–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–∞–∑–∞—Ç–∏:
- **Telegram Bot Token**
- **Telegram Chat ID**
- **Voltage entity**: `voltage_entity_id` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `sensor.smart_plug_2_voltage`)
- **debounce_seconds** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 10)
- **stale_timeout_seconds** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 300)
- **notify_on_start** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `true`) :contentReference[oaicite:3]{index=3}

> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: –æ–±–∏—Ä–∞–π —Å–∞–º–µ `sensor.*voltage`, –∞ –Ω–µ `switch.*`.

---

## ü§ñ –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ Telegram token

1. –í—ñ–¥–∫—Ä–∏–π BotFather –≤ Telegram: `@BotFather`
2. –°—Ç–≤–æ—Ä–∏ –±–æ—Ç–∞: `/newbot`
3. –°–∫–æ–ø—ñ—é–π **token**

---

## üí¨ –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ Chat ID

### –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–± (—á–µ—Ä–µ–∑ getUpdates)
1. –ù–∞–ø–∏—à–∏ –±–æ—Ç—É –±—É–¥—å-—è–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ ‚Äúhi‚Äù)
2. –í—ñ–¥–∫—Ä–∏–π —É –±—Ä–∞—É–∑–µ—Ä—ñ:https://api.telegram.org/bot{TOKEN}/getUpdates
3. –ó–Ω–∞–π–¥–∏ –≤ JSON:
- `chat` ‚Üí `id` ‚Äî —Ü–µ —ñ —î **chat_id**

> –Ø–∫—â–æ —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à –∫–∞–Ω–∞–ª: –¥–æ–¥–∞–π –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª —ñ –¥–∞–π –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å. –î–ª—è –∫–∞–Ω–∞–ª—ñ–≤ chat_id —á–∞—Å—Ç–æ –≤–∏–≥–ª—è–¥–∞—î —è–∫ `-100xxxxxxxxxx`.

---

## üß† –Ø–∫ –ø—Ä–∞—Ü—é—î –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è ‚Äú—Å–≤—ñ—Ç–ª–æ —î/–Ω–µ–º–∞—î‚Äù

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤–≤–∞–∂–∞—î ‚Äú–æ—Ñ—Ñ–ª–∞–π–Ω/–Ω–µ–º–∞—î —Å–≤—ñ—Ç–ª–∞‚Äù –∫–æ–ª–∏:
- state —Å–µ–Ω—Å–æ—Ä–∞: `unavailable`, `unknown`, `offline` :contentReference[oaicite:4]{index=4}
**–∞–±–æ**
- –¥–∞—Ç—á–∏–∫ –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–≤—Å—è –±—ñ–ª—å—à–µ –Ω—ñ–∂ `stale_timeout_seconds` (default 300s) :contentReference[oaicite:5]{index=5}

–ö–æ–ª–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –±–∞—á–∏—Ç—å ‚Äú–æ—Ñ—Ñ–ª–∞–π–Ω‚Äù, –≤–æ–Ω–∞ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î:
- `homeassistant.update_entity` –¥–ª—è `voltage_entity_id`,
—â–æ–± —à–≤–∏–¥—à–µ –ø—ñ–¥—Ç—è–≥–Ω—É—Ç–∏ –Ω–æ–≤—ñ –¥–∞–Ω—ñ –ø—ñ—Å–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–≤‚Äô—è–∑–∫—É/–∂–∏–≤–ª–µ–Ω–Ω—è. :contentReference[oaicite:6]{index=6}

---

## üì® –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

**–ü—Ä–∏ –∑–∞–ø—É—Å–∫—É (—è–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ notify_on_start):**
- üü¶ –ë–æ—Ç –±—É–ª–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ  
- ‚úÖ –ó–∞—Ä–∞–∑: —Å–≤—ñ—Ç–ª–æ —î / ‚ùå –ó–∞—Ä–∞–∑: —Å–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞—î  
- –ü—Ä–∏—Å—Ç—Ä—ñ–π: `sensor.xxx_voltage`  
- –ù–∞–ø—Ä—É–≥–∞: `230 –í`

**–ü—Ä–∏ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—ñ —Å–≤—ñ—Ç–ª–∞:**
- ‚ùå –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ  
- –°–≤—ñ—Ç–ª–æ –±—É–ª–æ: `1—á 12–º 5—Å`  
- –ù–∞–ø—Ä—É–≥–∞: `unknown/unavailable/...` –∞–±–æ –æ—Å—Ç–∞–Ω–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è

**–ü—Ä–∏ –ø–æ—è–≤—ñ —Å–≤—ñ—Ç–ª–∞:**
- ‚úÖ –°–≤—ñ—Ç–ª–æ –∑'—è–≤–∏–ª–æ—Å—å  
- –°–≤—ñ—Ç–ª–∞ –Ω–µ –±—É–ª–æ: `8–º 40—Å`  
- –ù–∞–ø—Ä—É–≥–∞: `230 –í` :contentReference[oaicite:7]{index=7}

---

## üõ†Ô∏è –ü–æ—Ä–∞–¥–∏ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

- `debounce_seconds`: 5‚Äì15 —Å–µ–∫, —â–æ–± –Ω–µ —Å–ø–∞–º–∏–ª–æ –ø—Ä–∏ –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø—Ä–æ—Å—ñ–¥–∞–Ω–Ω—è—Ö/–ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è—Ö.
- `stale_timeout_seconds`: –ø—ñ–¥–±–µ—Ä–∏ –ø—ñ–¥ —á–∞—Å—Ç–æ—Ç—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞—Ç—á–∏–∫–∞ (—á–∞—Å—Ç–æ 120‚Äì600 —Å–µ–∫).  
–ó–∞—Ä–∞–∑ –¥–µ—Ñ–æ–ª—Ç: **300 —Å–µ–∫**. :contentReference[oaicite:8]{index=8}
- –Ø–∫—â–æ ‚Äú–æ—Ñ—Ñ–ª–∞–π–Ω‚Äù —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –∑–∞–Ω–∞–¥—Ç–æ —Ä–∞–Ω–æ ‚Äî –∑–±—ñ–ª—å—à `stale_timeout_seconds`.
- –Ø–∫—â–æ ‚Äú–æ–Ω–ª–∞–π–Ω‚Äù –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —ñ–∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é ‚Äî –∑–º–µ–Ω—à `probe_every` –≤ –∫–æ–¥—ñ –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä —á–∞—Å—Ç–æ—Ç—É –æ–Ω–æ–≤–ª–µ–Ω—å Tuya.

---

## üß™ Troubleshooting

### –ù–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å ‚Äú–æ—Ñ—Ñ–ª–∞–π–Ω‚Äù
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –æ–±—Ä–∞–Ω–∏–π —Å–∞–º–µ `sensor.*voltage`, –∞ –Ω–µ `switch`.
- –ü–µ—Ä–µ–≤—ñ—Ä —É Developer Tools ‚Üí **States**, —è–∫ –∑–º—ñ–Ω—é—î—Ç—å—Å—è state –ø—Ä–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ —Ä–æ–∑–µ—Ç–∫–∏.

### –ù–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å ‚Äú–æ–Ω–ª–∞–π–Ω‚Äù
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –¥–∞—Ç—á–∏–∫ –Ω–∞–ø—Ä—É–≥–∏ —Ä–µ–∞–ª—å–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—è.
- –ü–æ–¥–∏–≤–∏—Å—å `last_updated/last_reported` —É —Å—Ç–∞–Ω—ñ —Å–µ–Ω—Å–æ—Ä–∞.
- –°–ø—Ä–æ–±—É–π –≤—Ä—É—á–Ω—É –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–µ—Ä–≤—ñ—Å:
- `homeassistant.update_entity` –¥–ª—è —Ç–≤–æ–≥–æ `sensor.*voltage`

### –ë–æ—Ç –Ω–µ –ø–∏—à–µ –≤ Telegram
- –ü–µ—Ä–µ–≤—ñ—Ä token/chat_id.
- –ü–µ—Ä–µ–≤—ñ—Ä, —â–æ –±–æ—Ç –º–∞—î –ø—Ä–∞–≤–æ –ø–∏—Å–∞—Ç–∏ –≤ —á–∞—Ç/–∫–∞–Ω–∞–ª.
- –ü–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏ Home Assistant.

---

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è
–î–æ–¥–∞–π `LICENSE` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ MIT), —è–∫—â–æ –ø–ª–∞–Ω—É—î—à –ø—É–±–ª—ñ—á–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π.
