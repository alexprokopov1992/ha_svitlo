# Power Watchdog (Home Assistant ‚Üí Telegram + SvitloBot)

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Home Assistant, —è–∫–∞ –≤—ñ–¥—Å—Ç–µ–∂—É—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Å–≤—ñ—Ç–ª–∞ –∑–∞ **–¥–∞—Ç—á–∏–∫–æ–º –Ω–∞–ø—Ä—É–≥–∏** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ Tuya-—Ä–æ–∑–µ—Ç–∫–∏) —Ç–∞:
- –Ω–∞–¥—Å–∏–ª–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ **Telegram** (–æ–ø—Ü—ñ–π–Ω–æ),
- —Ä–æ–±–∏—Ç—å **ping** —É **SvitloBot** (–æ–ø—Ü—ñ–π–Ω–æ) –∫–æ–ª–∏ —Å–≤—ñ—Ç–ª–æ —î.

## ‚úÖ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–∞–Ω—É —Å–≤—ñ—Ç–ª–∞ –∑–∞ `sensor.*voltage` (–Ω–∞–ø—Ä—É–≥–∞).
- Telegram-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è (—è–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö):
  - ‚ùå –∑–Ω–∏–∫–Ω–µ–Ω–Ω—ñ —Å–≤—ñ—Ç–ª–∞
  - ‚úÖ –ø–æ—è–≤—ñ —Å–≤—ñ—Ç–ª–∞
- –í–∏–≤–æ–¥–∏—Ç—å —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å:
  - **‚Äú–°–≤—ñ—Ç–ª–æ –±—É–ª–æ: ‚Ä¶‚Äù** –ø–µ—Ä–µ–¥ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º
  - **‚Äú–°–≤—ñ—Ç–ª–∞ –Ω–µ –±—É–ª–æ: ‚Ä¶‚Äù** –¥–æ –≤–∫–ª—é—á–µ–Ω–Ω—è
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ ‚Äú—Ñ–ª–∞–ø—ñ–≤‚Äù —á–µ—Ä–µ–∑ **debounce** (–∑–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º –ø–æ–¥—ñ—ó).
- –†–µ–∂–∏–º **stale timeout**: —è–∫—â–æ –¥–∞—Ç—á–∏–∫ –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–≤—Å—è N —Å–µ–∫—É–Ω–¥ ‚Äî –≤–≤–∞–∂–∞—î–º–æ ‚Äú—Å–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞—î‚Äù.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π ‚Äúprobe‚Äù –∫–æ–ª–∏ –æ—Ñ—Ñ–ª–∞–π–Ω: –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î `homeassistant.update_entity` –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö.
- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ): **‚Äú–ë–æ—Ç –±—É–ª–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ‚Äù**.
- **SvitloBot channelPing** (—è–∫—â–æ –∑–∞–¥–∞–Ω–æ `svitlobot_channel_key`):
  - —Ä–æ–±–∏—Ç—å GET:
    - `https://api.svitlobot.in.ua/channelPing?channel_key={SVITLOBOT_CHANNEL_KEY}`
  - **–∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥**, —è–∫—â–æ ‚Äú—Å–≤—ñ—Ç–ª–æ —î‚Äù.

> –ß–æ–º—É –¥–∞—Ç—á–∏–∫ –Ω–∞–ø—Ä—É–≥–∏ –∫—Ä–∞—â–µ –∑–∞ `switch`?  
> –£ Tuya `switch` —á–∞—Å—Ç–æ ‚Äú–∑–∞–ª–∏–ø–∞—î‚Äù –≤ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É —Å—Ç–∞–Ω—ñ –π –Ω–µ –æ–Ω–æ–≤–ª—é—î `last_updated`, —á–µ—Ä–µ–∑ —â–æ –æ—Ñ—Ñ–ª–∞–π–Ω/–æ–Ω–ª–∞–π–Ω –º–æ–∂–µ –≤–∏–∑–Ω–∞—á–∞—Ç–∏—Å—è –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–æ. –î–∞—Ç—á–∏–∫ –Ω–∞–ø—Ä—É–≥–∏ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω—ñ—à–µ.

---

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### –í–∞—Ä—ñ–∞–Ω—Ç A: –≤—Ä—É—á–Ω—É
1. –°–∫–æ–ø—ñ—é–π –ø–∞–ø–∫—É —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –≤ Home Assistant:  
   `/config/custom_components/power_watchdog/`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ Home Assistant.

### –í–∞—Ä—ñ–∞–Ω—Ç B: —á–µ—Ä–µ–∑ HACS (—è–∫—â–æ –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ `hacs.json`)
1. HACS ‚Üí **Custom repositories**
2. –î–æ–¥–∞–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π —è–∫ **Integration**
3. –í—Å—Ç–∞–Ω–æ–≤–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ HA
4. –î–æ–¥–∞–π —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é

---

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (—á–µ—Ä–µ–∑ UI)

Home Assistant ‚Üí **Settings ‚Üí Devices & Services ‚Üí Add Integration** ‚Üí `Power Watchdog`

–ü—ñ–¥ —á–∞—Å –¥–æ–¥–∞–≤–∞–Ω–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–∞–∑–∞—Ç–∏:
- **Telegram Bot Token**
- **Telegram Chat ID**
- **Voltage entity**: `sensor.*voltage` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `sensor.smart_plug_2_voltage`)
- **debounce_seconds** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 10)
- **stale_timeout_seconds** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 90)
- **refresh_seconds** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 30)
- **notify_on_start** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `true`)
- **telegram_enabled** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `true`)
- **svitlobot_channel_key** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–æ—Ä–æ–∂–Ω—å–æ)

> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: –æ–±–∏—Ä–∞–π —Å–∞–º–µ `sensor.*voltage`, –∞ –Ω–µ `switch.*`.

---

## ‚öôÔ∏è –î–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è (Options)

Home Assistant ‚Üí **Settings ‚Üí Devices & Services** ‚Üí `Power Watchdog` ‚Üí **Configure**

–¢–∞–º –º–æ–∂–Ω–∞:
- ‚úÖ **–≤–º–∏–∫–∞—Ç–∏/–≤–∏–º–∏–∫–∞—Ç–∏ Telegram-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è** (`telegram_enabled`)
- üîë –≤–∫–∞–∑–∞—Ç–∏/–∑–º—ñ–Ω–∏—Ç–∏ **SvitloBot channel key** (`svitlobot_channel_key`)

> –ó–º—ñ–Ω–∏ –≤ ‚ÄúConfigure‚Äù –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è –æ–¥—Ä–∞–∑—É (—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ).

---

## ü§ñ –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ Telegram token

1. –í—ñ–¥–∫—Ä–∏–π BotFather –≤ Telegram: `@BotFather`
2. –°—Ç–≤–æ—Ä–∏ –±–æ—Ç–∞: `/newbot`
3. –°–∫–æ–ø—ñ—é–π **token**

---

## üí¨ –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ Chat ID

### –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–± (—á–µ—Ä–µ–∑ getUpdates)
1. –ù–∞–ø–∏—à–∏ –±–æ—Ç—É –±—É–¥—å-—è–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ ‚Äúhi‚Äù)
2. –í—ñ–¥–∫—Ä–∏–π —É –±—Ä–∞—É–∑–µ—Ä—ñ:  
   `https://api.telegram.org/bot{TOKEN}/getUpdates`
3. –ó–Ω–∞–π–¥–∏ –≤ JSON:
   - `chat` ‚Üí `id` ‚Äî —Ü–µ —ñ —î **chat_id**

> –Ø–∫—â–æ —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à –∫–∞–Ω–∞–ª: –¥–æ–¥–∞–π –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª —ñ –¥–∞–π –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å. –î–ª—è –∫–∞–Ω–∞–ª—ñ–≤ chat_id —á–∞—Å—Ç–æ –≤–∏–≥–ª—è–¥–∞—î —è–∫ `-100xxxxxxxxxx`.

---

## üåê SvitloBot: channelPing

–Ø–∫—â–æ —Ç–∏ –∑–∞–¥–∞–≤ **svitlobot_channel_key**, —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ GET-–∑–∞–ø–∏—Ç:

`https://api.svitlobot.in.ua/channelPing?channel_key={SVITLOBOT_CHANNEL_KEY}`

–£–º–æ–≤–∏:
- –ü—ñ–Ω–≥ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è **–∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥**, **—Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ —Å–≤—ñ—Ç–ª–æ —î**.
- –Ø–∫—â–æ `svitlobot_channel_key` –ø–æ—Ä–æ–∂–Ω—ñ–π ‚Äî **–ø—ñ–Ω–≥ –Ω–µ —Ä–æ–±–∏—Ç—å—Å—è**.

---

## üß† –Ø–∫ –ø—Ä–∞—Ü—é—î –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è ‚Äú—Å–≤—ñ—Ç–ª–æ —î/–Ω–µ–º–∞—î‚Äù

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤–≤–∞–∂–∞—î ‚Äú–æ—Ñ—Ñ–ª–∞–π–Ω/–Ω–µ–º–∞—î —Å–≤—ñ—Ç–ª–∞‚Äù –∫–æ–ª–∏:
- state —Å–µ–Ω—Å–æ—Ä–∞: `unavailable`, `unknown`, `offline`
**–∞–±–æ**
- –¥–∞—Ç—á–∏–∫ –Ω–µ –æ–Ω–æ–≤–ª—é–≤–∞–≤—Å—è –±—ñ–ª—å—à–µ –Ω—ñ–∂ `stale_timeout_seconds` (default 90s)

–ö–æ–ª–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –±–∞—á–∏—Ç—å ‚Äú–æ—Ñ—Ñ–ª–∞–π–Ω‚Äù, –≤–æ–Ω–∞ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î:
- `homeassistant.update_entity` –¥–ª—è `voltage_entity_id`,
—â–æ–± —à–≤–∏–¥—à–µ –ø—ñ–¥—Ç—è–≥–Ω—É—Ç–∏ –Ω–æ–≤—ñ –¥–∞–Ω—ñ –ø—ñ—Å–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–≤‚Äô—è–∑–∫—É/–∂–∏–≤–ª–µ–Ω–Ω—è.

---

## üì® –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å Telegram

**–ü—Ä–∏ –∑–∞–ø—É—Å–∫—É (—è–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ notify_on_start):**
- üü¶ –ë–æ—Ç –±—É–ª–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ  
- ‚úÖ –ó–∞—Ä–∞–∑: —Å–≤—ñ—Ç–ª–æ —î / ‚ùå –ó–∞—Ä–∞–∑: —Å–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞—î  
- –ü—Ä–∏—Å—Ç—Ä—ñ–π: `sensor.xxx_voltage`  
- –ù–∞–ø—Ä—É–≥–∞: `230 –í`

**–ü—Ä–∏ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—ñ —Å–≤—ñ—Ç–ª–∞:**
- ‚ùå –°–≤—ñ—Ç–ª–æ –∑–Ω–∏–∫–ª–æ  
- –°–≤—ñ—Ç–ª–æ –±—É–ª–æ: `1–≥ 12—Ö–≤ 5—Å`  
- (–Ω–∞–ø—Ä—É–≥–∞ –º–æ–∂–µ –±—É—Ç–∏ `unknown/unavailable/...` –∞–±–æ –æ—Å—Ç–∞–Ω–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è)

**–ü—Ä–∏ –ø–æ—è–≤—ñ —Å–≤—ñ—Ç–ª–∞:**
- ‚úÖ –°–≤—ñ—Ç–ª–æ —î  
- –°–≤—ñ—Ç–ª–∞ –Ω–µ –±—É–ª–æ: `8—Ö–≤ 40—Å`  
- –ù–∞–ø—Ä—É–≥–∞: `230 –í`

> –Ø–∫—â–æ `telegram_enabled = false` ‚Äî –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram –Ω–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è.

---

## üõ†Ô∏è –ü–æ—Ä–∞–¥–∏ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

- `debounce_seconds`: 5‚Äì15 —Å–µ–∫, —â–æ–± –Ω–µ —Å–ø–∞–º–∏–ª–æ –ø—Ä–∏ –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø—Ä–æ—Å—ñ–¥–∞–Ω–Ω—è—Ö/–ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è—Ö.
- `stale_timeout_seconds`: –ø—ñ–¥–±–µ—Ä–∏ –ø—ñ–¥ —á–∞—Å—Ç–æ—Ç—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞—Ç—á–∏–∫–∞ (—á–∞—Å—Ç–æ 60‚Äì600 —Å–µ–∫).  
  –î–µ—Ñ–æ–ª—Ç: **90 —Å–µ–∫**.
- `refresh_seconds`: —è–∫ —á–∞—Å—Ç–æ –ø—Ä–∏–º—É—Å–æ–≤–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å–µ–Ω—Å–æ—Ä —á–µ—Ä–µ–∑ `update_entity` (default 30 —Å–µ–∫).
- –Ø–∫—â–æ ‚Äú–æ—Ñ—Ñ–ª–∞–π–Ω‚Äù —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –∑–∞–Ω–∞–¥—Ç–æ —Ä–∞–Ω–æ ‚Äî –∑–±—ñ–ª—å—à `stale_timeout_seconds`.

---

## üß™ Troubleshooting

### –ù–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å ‚Äú–æ—Ñ—Ñ–ª–∞–π–Ω‚Äù
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –æ–±—Ä–∞–Ω–∏–π —Å–∞–º–µ `sensor.*voltage`, –∞ –Ω–µ `switch`.
- –ü–µ—Ä–µ–≤—ñ—Ä —É Developer Tools ‚Üí **States**, —è–∫ –∑–º—ñ–Ω—é—î—Ç—å—Å—è state –ø—Ä–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ –∂–∏–≤–ª–µ–Ω–Ω—è.

### –ù–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å ‚Äú–æ–Ω–ª–∞–π–Ω‚Äù
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –¥–∞—Ç—á–∏–∫ –Ω–∞–ø—Ä—É–≥–∏ —Ä–µ–∞–ª—å–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—è.
- –ü–æ–¥–∏–≤–∏—Å—å `last_updated/last_reported` —É —Å—Ç–∞–Ω—ñ —Å–µ–Ω—Å–æ—Ä–∞.
- –°–ø—Ä–æ–±—É–π –≤—Ä—É—á–Ω—É –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–µ—Ä–≤—ñ—Å:
  - `homeassistant.update_entity` –¥–ª—è —Ç–≤–æ–≥–æ `sensor.*voltage`

### –ë–æ—Ç –Ω–µ –ø–∏—à–µ –≤ Telegram
- –ü–µ—Ä–µ–≤—ñ—Ä token/chat_id.
- –ü–µ—Ä–µ–≤—ñ—Ä, —â–æ `telegram_enabled = true`.
- –ü–µ—Ä–µ–≤—ñ—Ä, —â–æ –±–æ—Ç –º–∞—î –ø—Ä–∞–≤–æ –ø–∏—Å–∞—Ç–∏ –≤ —á–∞—Ç/–∫–∞–Ω–∞–ª.
- –ü–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏ Home Assistant.

### SvitloBot –Ω–µ –±–∞—á–∏—Ç—å ping
- –ü–µ—Ä–µ–≤—ñ—Ä, —â–æ `svitlobot_channel_key` –∑–∞–¥–∞–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
- –ü–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏ Home Assistant (—è–∫—â–æ API –ø–æ–≤–µ—Ä—Ç–∞—î 4xx/5xx, –±—É–¥–µ warning).

---

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è
–î–æ–¥–∞–π `LICENSE` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ MIT), —è–∫—â–æ –ø–ª–∞–Ω—É—î—à –ø—É–±–ª—ñ—á–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π.
